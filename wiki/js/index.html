<!DOCTYPE html>
<html>
	<head>
		<title>Wiki Viewer</title>

		<meta name="viewport"
			  content="width=device-width,
					   user-scalable=no"/>

		<link rel="shortcut icon" type="image/x-icon"
			href="http://quote.frenata.net/favicon.ico" >
		<link rel="icon" type="image/x-icon"
			href="http://quote.frenata.net/favicon.ico" >
		<link rel="stylesheet" type="text/css" href="style.css" />
	</head>
<body>
	<div id="container">
		<div id="search">
			<form id="query">
				<input 
					placeholder="Search the Wiki!" 
					autofocus="true"/>
				<div id="buttons">
					<button id="search-btn">Search</button>
					<button id="random-btn">Random</button>
				</div>
			</form>
			<form id="random"
				action="https://en.wikipedia.org/wiki/Special:Random"
				method="get"
				target="_blank">
			</form>
		</div>

		<div id="results">
			<!--<h2>Results</h2>-->
		</div>

	</div>
	<script>

document.querySelector("#query").addEventListener("submit", 
	(e) => {
		getWiki(document.querySelector("#query input").value);
		e.preventDefault();
	}
	,false);

document.querySelector("#random-btn").addEventListener("click",
	(e) => {
		window.open('https://en.wikipedia.org/wiki/Special:Random');
		e.preventDefault();
	}
	,false);

function getWiki(search) {
	let url = "https://en.wikipedia.org/w/api.php?" +
		"action=opensearch&format=json&origin=*&search=" + search;
	
	getJSON(url, (err,data) => 
		err != null ?
			console.log(err) :
			writeWikiResults(data[1],data[2],data[3])
	);
}

function writeWikiResults(title,description,link){
	clearResults();

	title.forEach((_,i) =>
		appendResult(title[i],description[i],link[i]));
}

function clearResults() {
	document.querySelector("#results").innerHTML = "";
}

function appendResult(title,description,link) {
	document.querySelector("#results").innerHTML += 
		"<a target=\"_blank\" href=\"" 
		+ link + "\" class=\"result\">" + 
		"<div>" +
		"<h3>"+title+"</h3>" +
		"<p>" + description + "</p>" +
		"</div></a>";
}

function getJSON(url, callback) {
	let xhr = new XMLHttpRequest();

	xhr.open("GET", url, true);
	xhr.responseType = "json";
	xhr.onload = () => 
		xhr.status == 200 ?
			callback(null, xhr.response) :
			callback(status);
	xhr.send();
}

	</script>
</body>
</html>
